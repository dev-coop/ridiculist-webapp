"use strict";function list(t,e,i,o){return{restrict:"E",replace:!0,scope:{},templateUrl:"app/components/item-list/item-list.html",link:function(r,n,s){var a=t.id;r.init=function(){r.LIST_TYPES=o,r.isNew=!a,r.isNew?(r.itemList=new i,r.addItem()):i.getByListId(a).then(function(t){r.itemList=t})},r.addItem=function(){r.itemList.add({type:r.itemList.list.type})},r.focusItem=function(t){var e=document.getElementsByClassName("lst-list-item-input")[t];e&&e.focus()},r.onItemChange=function(){var t=0;r.itemList.items.forEach(function(e,i,o){var n=0===e.name.trim().length,s=i===o.length-1;t+=n?1:0,n&&!s&&(r.focusItem(i),o.splice(i,1))}),0===t&&r.addItem()},r.setListType=function(t){r.itemList.setType(t)},r.save=function(){r.itemList.save()},r.getLink=function(){return r.itemList.getLink()},r.onCopy=function(){r.linkCopied=!0,e(function(){r.linkCopied=!1},1e3)},r.handleEnterKey=function(t,e){var i;t.metaKey?r.save():(i=t.shiftKey?-1:1,r.focusItem(e+i))},r.onKeydown=function(t,e){switch(t.keyCode){case 13:r.handleEnterKey(t,e)}},r.init()}}}angular.module("App",["ngRoute","firebase","ngClipboard","LocalStorageModule","App.itemList"]).run(["ListFactory","ItemFactory","ItemListFactory",function(t,e,i){}]).config(["ngClipProvider",function(t){t.setPath("app/bower/zeroclipboard/dist/ZeroClipboard.swf")}]).config(["localStorageServiceProvider",function(t){t.setPrefix("ridiculist").setStorageType("sessionStorage").setNotify(!0,!0)}]).config(["$routeProvider","$locationProvider",function(t,e){t.otherwise({redirectTo:"/"}),e.html5Mode(!0).hashPrefix("!")}]),angular.module("App.itemList",[]),angular.module("App.session",[]);var FIREBASE={};FIREBASE.root="https://ridiculist.firebaseio.com/",FIREBASE.lists=FIREBASE.root+"lists",FIREBASE.items=FIREBASE.root+"items";var LIST_ICONS={todo:"ion-android-checkbox-outline",vote:"ion-android-star-outline",survey:"ion-android-radio-button-on"},LIST_TYPES={todo:"todo",vote:"vote",survey:"survey"};angular.module("App.itemList").constant("FIREBASE",FIREBASE).constant("LIST_ICONS",LIST_ICONS).constant("LIST_TYPES",LIST_TYPES);var ItemFactory=function(t,e,i,o){function r(t){t=t||{},this.listId=t.listId||"",this.name=t.name||"",this.sort=t.sort||0,this.type=t.type||o.todo,this.value=t.value||0}var n=new Firebase(e.items),s=i(n);return r.getByListId=function(e){var o=t.defer(),s=[],a=n.orderByChild("listId").equalTo(e);return i(a).$loaded().then(function(t){angular.forEach(t,function(t){s.push(new r(t))}),o.resolve(s)}),o.promise},r.prototype.add=function(){if(!this.listId)throw new Error("Item.save() requires a `listId` property to save.");return s.$add(this).then(function(t){var e=s.$getRecord(t.key());return new r(e)})},r.prototype.increment=function(){return this.value+=1,this},r.prototype.decrement=function(){return this.value-=1,this},r.prototype.setValue=function(t){return this.value=t,this},window.Item=r,r};ItemFactory.$inject=["$q","FIREBASE","$firebaseArray","LIST_TYPES"],angular.module("App.itemList").factory("ItemFactory",ItemFactory);var ItemListFactory=function(t,e,i){function o(t){this.items=[],this.list=new i,angular.extend(this,t)}return o.getByListId=function(r){var n=t.defer();return t.all({items:e.getByListId(r),list:i.getById(r)}).then(function(t){var e=new o(t);n.resolve(e)}),n.promise},o.prototype.getLink=function(t){return this.list.getLink()},o.prototype.setType=function(t){var e=LIST_TYPES[t];if(!e)throw new Error('ItemList.setType(type) `type` must be a LIST_TYPE, not: "'+t+'"');this.list.type=e,angular.forEach(this.items,function(t){t.type=e})},o.prototype.save=function(){var e=t.defer(),i=this;return i.list.add().then(function(t){angular.forEach(i.items,function(e){e.name&&(e.listId=t.$id,e.add())}),e.resolve(i)}),e.promise},o.prototype.add=function(t){var i=new e(t);return this.items.push(i),this},o.prototype.remove=function(){return this},o};ItemListFactory.$inject=["$q","ItemFactory","ListFactory"],angular.module("App.itemList").factory("ItemListFactory",ItemListFactory);var ListFactory=function(t,e,i){function o(t){t=t||{},this.title="",this.security="public",this.type="todo",angular.extend(this,t)}var r=new Firebase(e.lists),n=i(r);return o.getById=function(e){var i=t.defer();return n.$loaded().then(function(){var t=n.$getRecord(e),r=new o(t);i.resolve(r)}),i.promise},o.prototype.add=function(){return n.$add(this).then(function(t){var e=n.$getRecord(t.key());return new o(e)})},o.prototype.getLink=function(){return this.$id?"www.ridiculi.st/"+this.$id:null},window.List=o,o};ListFactory.$inject=["$q","FIREBASE","$firebaseArray"],angular.module("App.itemList").factory("ListFactory",ListFactory);var SessionFactory=function(){var t={};return t};angular.module("App.session").factory("SessionFactory",SessionFactory),list.$inject=["$routeParams","$timeout","ItemListFactory","LIST_TYPES"],angular.module("App.itemList").directive("list",list),angular.module("App").config(["$routeProvider",function(t){t.when("/:id",{templateUrl:"/app/views/home/home.html",controller:"Controller"}).when("/",{templateUrl:"/app/views/home/home.html",controller:"Controller"})}]).controller("Controller",["$scope","FIREBASE","$firebaseObject","$routeParams","LIST_ICONS",function(t,e,i,o,r){var n=new Firebase(e.lists);t.lists=i(n),t.LIST_ICONS=r,t.idUrlParam=o.id}]);